"use strict";const e=require("../../common/vendor.js"),o={__name:"join",setup(o){const{globalData:{openId:n}}=new getApp,{nickName:a,avatarUrl:s}=e.index.getStorageSync("userInfo"),t=e.index.getStorageSync("homePersonnelInfo"),l=e.ref(t);console.log(l);let d=e.ref(""),u=e.ref();e.onLoad((e=>{console.log(e),d.value=e.homeId,u.value=Boolean(e.Homeowner),console.log(u.value),c()})),e.onHide((()=>{console.log(111),i()}));const c=()=>{console.log(d.value),e.index.connectSocket({url:`wss://zyandwqy.top/websocket/${n}/${d.value}`}),e.index.onSocketOpen((()=>{console.log("连接成功");const o={openId:n,nickName:a,img:s,status:1,houseId:d.value};e.index.sendSocketMessage({data:JSON.stringify(o)})})),e.index.onSocketMessage((o=>{console.log(JSON.parse(o.data));const n=JSON.parse(o.data);if(null!==n)if("toGame"!==n.toGame){if(1===n.status){const e=l.value.findIndex((e=>e.openId===n.openId));console.log(e),-1===e&&l.value.push(n)}else if(0===n.status){const e=l.value.findIndex((e=>e.openId===n.openId));console.log(e),-1!==e&&l.value.splice(e,1)}}else e.index.navigateTo({url:`/pages/game/game?houseId=${d.value}`})}))},i=()=>{e.index.request({url:"https://wx.zyandwqy.top/user/logout",data:{open_id:n}});const o={openId:n,nickName:a,img:s,status:0,houseId:d.value};e.index.sendSocketMessage({data:JSON.stringify(o)}),e.index.closeSocket()},g=()=>{const o={toGame:"toGame",houseId:d.value};e.index.sendSocketMessage({data:JSON.stringify(o)}),e.index.navigateTo({url:`/pages/game/game?houseId=${d.value}`})};return(o,n)=>e.e({a:e.t(e.unref(d)),b:e.f(l.value,((e,o,n)=>({a:`url(${e.img})`,b:e.openId}))),c:e.unref(u)},e.unref(u)?{d:e.o(g)}:{})}},n=e._export_sfc(o,[["__scopeId","data-v-a15fad95"]]);wx.createPage(n);
